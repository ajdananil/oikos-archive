{{- define "main" -}}

<div class="mw9 center mt2 mb5 min-vh-100">
  <div class="flex flex-wrap mhn1 pa3 justify-center">
    <!-- Image container -->
    <div id="image-container" class="w-100 flex inline-flex justify-center pa3">
      {{- .Render "hasRep" -}}
      {{- $hasRepresentation := .Scratch.Get "hasRepresentation" -}}
      
      <div id="gallery" class="flex items-center">
        {{- if $hasRepresentation -}}
          {{- $representations := .Site.GetPage "section" "representations" -}}
          {{- $uuid := .Params.uuid -}}
          {{- range $representations.Pages -}}
            {{- if eq $uuid .Params.speciesid -}}
              <div class="gallery-item mr4 ml4" onclick="moveToCenter(this)">
                <img class="h-auto mht6" src="representations/{{- .Params.speciesid -}}{{- .Params.image -}}" alt="">
                <div class="flex flex-column f6">
                  <div><i>{{ .Params.title | default "Untitled" }}</i> ({{ .Params.year | default "unknown year" }})</div>
                  <div>{{ .Params.author | default "Unknown Artist" }}</div>
                  <div>{{ .Params.contact | default "-" }}</div>
                </div>
              </div>
            {{- end -}}
          {{- end -}}
<script>
function moveToCenter(selectedItem) {
  const gallery = document.getElementById('gallery');
  let items = document.querySelectorAll('.gallery-item');

  // Get the center of the gallery viewport
  let galleryCenter = gallery.clientWidth / 2;

  // Reset all items' transformations before calculating new centering
  items.forEach(item => {
    item.style.transform = 'translateX(0px)';
  });

  // After reset, calculate the centering transformation
  setTimeout(() => {
    // Recalculate the selected item's center based on its current position within the gallery
    let itemOffset = selectedItem.offsetLeft; // Left offset of the item within the gallery
    let itemWidth = selectedItem.clientWidth; // Width of the item
    let itemInitialCenter = itemOffset + (itemWidth / 2); // Center position of the item

    // Calculate the shift needed to center the item
    let shiftX = galleryCenter - itemInitialCenter;

    // Apply a transform to each item to create the effect of centering the selected item
    items.forEach(item => {
      item.style.transform = `translateX(${shiftX}px)`;
    });

    // Update classes for centered and non-centered items
    items.forEach(item => {
      item.classList.remove('centered');
      item.style.filter = 'grayscale(1)';
      let innerDiv = item.querySelector('div.flex'); // Adjust the selector as needed
      innerDiv.classList.remove('imghighlight');
      innerDiv.style.filter = 'opacity(0.4)';
    });

    selectedItem.classList.add('centered');
    selectedItem.style.filter = 'grayscale(0)';
    let selectedInnerDiv = selectedItem.querySelector('div.flex'); // Adjust the selector as needed
    selectedInnerDiv.classList.add('imghighlight');
    selectedInnerDiv.style.filter = 'opacity(1)';
  }, 10); // Short delay to ensure styles reset
}

window.addEventListener('resize', function() {
  if (document.querySelector('.centered')) {
    moveToCenter(document.querySelector('.centered')); // Re-center the currently centered item when window is resized
  }
});


document.addEventListener('DOMContentLoaded', function() {
  const gallery = document.getElementById('gallery');
  let items = document.querySelectorAll('.gallery-item');

  if (items.length > 0) {
    // Generate a random index
    let randomIndex = Math.floor(Math.random() * items.length);

    // Call moveToCenter with the randomly selected item
    moveToCenter(items[randomIndex]);
  }
});




</script>
      </div>
      
        {{- else -}}
          {{- .Render "englishName" -}}
          {{- $englishName := .Scratch.Get "englishName" | title -}} 
          {{- $otherName := .Scratch.Get "otherName" | title -}}
          {{- .Render "pathCalc" -}}
          <!-- SVG and Title -->
          <div class="svg-container tc w-100 mb3 mt3">
            <svg width="350px" height="150px" xmlns="http://www.w3.org/2000/svg" style="filter:blur(20px)">
                <path fill="transparent" stroke="{{- .Page.Params.color -}}" stroke-width="100" class="morphing-path" d="{{- .Scratch.Get "svgPath" -}}"></path>
              </svg>     
            <h2 class="f2 title comp-color" style="color: {{- .Params.color -}}; margin-bottom: -1rem; transform: translateY(-5rem);">
              {{- if $englishName -}} {{- $englishName -}}{{- else -}}{{- $otherName -}}{{- end -}}
            </h2>   
          </div>
        {{- end }}
      
    </div>
    <!-- Additional Info -->
    <div id="content-container" class="w-100 flex flex-column items-center justify-center pa3"> 
      <div class="info-container pa3">
        <div>
          <h2 class="f4">Info</h2>
          <ul>
            <li class="f6">File Name: {{ if .Params.fileName -}}{{ .Params.fileName -}}{{- else }}?{{- end -}}</li>
            <li class="f6">Species Category: {{ .Params.category }}</li>
          </ul>
        </div>
        <div class="mt3">
          <h2 class="f4">Names</h2>
          <ul class="f6 list pl0">
            {{- range .Params.languages -}}
              {{- $currentLanguage := .language }} 
              {{- with .names -}} 
                <li>
                  <strong>{{ $currentLanguage }}: </strong> 
                  {{- range . -}} 
                    <span>{{ . | title }}</span>
                    {{- if not (eq (index . (sub (len .) 1)) .) }}{{ end }} 
                  {{- end -}}
                </li>
              {{- end -}}
            {{- end -}}
          </ul>
        </div>
        <div class="mt3 f6">
          {{- .Render "englishName" -}}
          {{- $englishName := .Scratch.Get "englishName" | title -}} 
          {{- $otherName := .Scratch.Get "otherName" | title -}}
          <h2 class="f4">Collective knowledge and stories about The {{ if $englishName -}} {{- $englishName -}}{{- else -}}{{- $otherName -}}{{- end -}}</h2>
          {{- if .Content -}}
            <p>{{ .Content }}</p>
          {{- else -}}
            <p>No stories available.</p>
          {{- end -}}
        </div>
      </div>
    </div>
  </div>
</div>



{{- end -}}


